---
title: "Example 6.2: Silicon Search using Python/ASE with GAP"
layout: single
classes: wide
lang: en
lang-ref: example-6-2
sidebar:
  nav: "docs"
---

**Download input files:**
[<i class="fas fa-download"></i> Si.cell]({{ '/assets/examples/6.2/Si.cell' | relative_url }}){: .btn .btn--primary .btn--small}
[<i class="fas fa-download"></i> relax.py]({{ '/assets/examples/6.2/relax.py' | relative_url }}){: .btn .btn--primary .btn--small}

## Prerequisites

QUIP is required, with the GAP extension, as well as quippy. Full installation instructions are [here](https://github.com/libAtoms/QUIP), but it should be sufficient to install quippy via pip:

```console
$ pip install quippy-ase
```

GAP data files are also required, namely the Si_PRX_GAP potential available [here](https://www.repository.cam.ac.uk/handle/1810/317974). Place the `Si_PRX_GAP` directory in the directory with this README:

```console
$ ls Si_PRX_GAP

gp_iter6_sparse9k.xml
gp_iter6_sparse9k.xml.sparseX.GAP_2017_6_17_60_4_3_56_1651
gp_iter6_sparse9k.xml.xyz
repulsive_2b.xml
sparse_point_environment_and_config_type_list
```

## Performing the search

We now perform a search:


**`Si.cell`:**

```
%BLOCK LATTICE_CART
2.7 0.0 0.0
0.0 2.7 0.0
0.0 0.0 2.7
%ENDBLOCK LATTICE_CART

%BLOCK POSITIONS_FRAC
Si 0.0 0.0 0.0 # Si1 % NUM=4
%ENDBLOCK POSITIONS_FRAC

#MINSEP=1.3
```

**`relax.py`:**

```python
from ase import Atoms
from ase.constraints import ExpCellFilter
import ase.io
from ase.optimize import LBFGSLineSearch
import numpy as np
from quippy.potential import Potential
import sys
to_eV_per_A3 = 1.0 / 160.2177 # from GPa

#------------------------------------------------

# Collect command line input and load random structure
pressure = float(sys.argv[1])
seed = sys.argv[2]
atoms = ase.io.read(seed + '.xyz')

# Relax cell using GAP
gap_file = 'Si_PRX_GAP/gp_iter6_sparse9k.xml'
atoms.calc = Potential(param_filename=gap_file)
ecf = ExpCellFilter(atoms, scalar_pressure=pressure*to_eV_per_A3)
optimizer = LBFGSLineSearch(ecf)
optimizer.run(2e-4, 1000)

# If converged, output final structure and fake castep file
if optimizer.converged():
    ase.io.write(seed + '-out.xyz', atoms, 'extxyz')
    volume = atoms.get_volume()
    pv = pressure*to_eV_per_A3 * volume
    enthalpy = atoms.get_potential_energy() + pv
    with open(seed + '.castep', 'w') as f:
        f.write("Current cell volume = {:25.15f} A**3\n".format(volume))
        f.write("*  Pressure:   {:25.15f}\n".format(pressure))
        f.write("Python: Final Enthalpy     = {:25.15f} eV\n".format(enthalpy))
```

```console
$ airss.pl -python -max 20 -seed Si
```

obtaining:

```console
$ ca -u 0.01 -r

Si-10921-3998-10         0.00    20.357    -163.178   4 Si           Fd-3m          1
Si-10921-3998-8          0.00    20.336       0.009   4 Si           P63/mmc        2
Si-10921-3998-6          0.00    17.413       0.319   4 Si           C2/m           2
Si-10921-3998-16         0.00    15.386       0.321   4 Si           I41/amd        1
Si-10921-3998-9          0.00    19.927       0.331   4 Si           P4122          1
Si-10921-3998-20         0.00    18.469       0.333   4 Si           C2/m           1
Si-10921-3998-4          0.00    19.095       0.334   4 Si           I212121        1
Si-10921-3998-14         0.00    15.144       0.342   4 Si           P6/mmm         1
Si-10921-3998-13         0.00    15.530       0.347   4 Si           Cmmm           1
Si-10921-3998-1          0.00    15.563       0.362   4 Si           Pbcm           1
Si-10921-3998-3          0.00    20.006       0.387   4 Si           C2             1
Si-10921-3998-11         0.00    17.891       0.407   4 Si           C2/m           1
Si-10921-3998-19         0.00    21.727       0.409   4 Si           Imma           1
Si-10921-3998-12         0.00    21.554       0.424   4 Si           Cmmm           1
Si-10921-3998-2          0.00    34.552       0.496   4 Si           P-1            1
Si-10921-3998-18         0.00    42.878       0.574   4 Si           Pm             1
Si-10921-3998-17         0.00    28.126       0.763   4 Si           Cm             1
Si-10921-3998-15         0.00    29.692       0.843   4 Si           Cm             1
```

This search did yield the expected cubic diamond ground state (space group `Fd-3m`), but only once. In general, a larger search may be required to find it.

---

**Previous:** [Example 6.1: Lennard-Jones Solid using Python/ASE]({{ '/tutorials/6.1/' | relative_url }})
